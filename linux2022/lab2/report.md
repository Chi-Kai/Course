## 实验目的

1. 掌握shell语言的基本语法

2. 能够通过shell脚本来解决实际问题

3. 能够解决试验中遇到的错误

## 实验内容

请完成题目1和2~4中任选一题

1．“实验2数据．zip”保存了7次实验课出勤的记录，每次上课进行两次点名，每天的两次点名只要出现1次就认定本次上课出勤。请统计每名学生出勤的次数，并按账号顺序排序。输出格式为：学生账号：次数。

2．回文数是指其各位数字左右对称的整数，例如121,1001,92329等。编写一个程序，输入一个正整数n，打印从1-n之间的回文数，并统计个数。

3．输入一正整数n，打印1-n之间的整数，要求去掉包含7的数字和7的整数倍的数字。

4．编程实现创建成绩单文件score．txt。要求：成绩单至少包括学号、姓名及其成绩3项内容，至少能够从键盘添加、删除和查询。

## 实验步骤

**Q1**:
```sh
# 删除tmp文件夹和结果文件
if [ -f "date" ]; then 
   rm -rf date
fi 
# 删除tmp文件夹
if [ -d "tmp" ]; then 
	 rm -rf tmp
fi
# 创建tmp文件夹
mkdir tmp
path=$1
files=$(ls $path)
# 遍历文件 将前8个字符相同的文件名放入一个文件中
for file in $files
do 
	if [ -f $path/$file ]
	then
		if [ -f tmp/${file:0:8} ]
		then
			cat $path/$file >> tmp/${file:0:8}
		else
			touch tmp/${file:0:8}
			cat $path/$file >> tmp/${file:0:8}
		fi
	fi
done

# 统计两个文件中关键词出现的次数
res=$(ls tmp)

for f in $res 
do 
  # 使用awk 统计 用空格间隔的第一个字段 抽出stu的学生字段，排序,去重后输入到结果文件
  awk '{print $1}' tmp/$f | grep 'stu' | sort -n | uniq >> d
done

for id in $(cat d|sort -n|uniq)
do
    num=$(grep -c $id d)
    echo "$id:$num"
done
rm -rf d
rm -rf tmp
exit 0
```
这个脚本需要data目录作为参数,因为已知每天会进行不定期点名(题中为2次)。这里先将同一天的点名文件合并到同一个文件中，存放在临时目录tmp里。

这里使用bash中file:0:8的语法,截取前8个文件名字符(年月日)来确定是否是同一节课。

遍历tmp目录下的文件,使用awk处理。取得第一个用户名字段,再用grep匹配stu来确定学生账号。

将所得到的数据排序去重再输出到结果文件d中

下一步,将结果文件中的数据排序去重。

使用grep 对每个ID计数然后然后输出

最后删除tmp文件夹和结果文件

**Q3**：
```sh
#输入一个数字n，打印出1-n之间的所有数字，去掉包含7的数字和7的倍数
#!/bin/sh

#请输入n
echo "请输入n"
read n
for i in `seq 1 $n`
do
    #转换为字符串
    str=$i
		#判断是否包含7或是7的倍数
		if [ `expr $i % 7` -eq 0 ] || [ [ $str =~ 7 ]]
		then
				continue
		else
				echo $i
		fi
done
```
首先读取一个数字n。

使用seq命令获得从1-n的所有数。

将数字转换为字符串,判断是否包含7或者是7的倍数。是就跳过，不是就输出。


## 实验结果

![Q1](https://i.imgur.com/pagY59X.png)

可以看到需要输入一个数据目录，可以得到学生的出勤情况。

![Q3](https://i.imgur.com/k7DEDV9.png)

可以看到输入n后得到正确结果。

## 实验分析与总结

- 分析:
   
1. 如果要使用文件或者文件夹，首先要判断是否它存在。如果不存在就创建一个。

2. 对字符串的处理命令: 

        awk 适合处理复杂的逻辑，如分割字符串,计数等;
        grep 适合处理查找匹配问题
        sed 适合处理字符串修改问题

3. sh脚本的间隔要符合规范，多加少加空格就会有歧义。

- 总结:
  
  此次实验通过对实际问题的解决，我基本掌握了sh脚本的语法和使用，同时巩固了一些常用命令的使用。sh脚本灵活实用，是linux系统重要的一部分,熟练掌握对我今后的学习工作具有很大帮助。
    


